{% comment %}
  Product Password Modal
  Renders the password protection overlay and modal

  Accepts:
  - product: {Object} Product Liquid object (required)
  - settings: {Object} Section settings (optional)

  Usage:
  {% render 'product-password-modal', product: product, settings: section.settings %}
{% endcomment %}

{%- assign is_protected = product.metafields.custom.is_password_protected -%}
{%- assign access_password = product.metafields.custom.access_password -%}
{%- assign access_prompt = product.metafields.custom.access_prompt -%}

{%- if is_protected and access_password != blank -%}
  {%- comment -%} Use section settings or defaults {%- endcomment -%}
  {%- assign show_title = settings.password_show_title -%}
  {%- assign show_placeholder = settings.password_show_placeholder -%}
  {%- assign submit_text = settings.password_submit_text | default: 'Enter' -%}
  {%- assign overlay_color = settings.password_overlay_color | default: '#000000' -%}
  {%- assign overlay_opacity = settings.password_overlay_opacity | default: 100 -%}
  {%- assign prompt_font_size = settings.password_prompt_font_size | default: 16 -%}
  {%- assign modal_bg_color = settings.password_modal_bg_color | default: '' -%}
  
  {%- style -%}
    .product-password-overlay.active {
      background-color: {{ overlay_color }};
    }
    
    .product-password-overlay {
      background-color: {{ overlay_color }};
    }
    
    {% if modal_bg_color != blank %}
    .product-password-modal {
      background-color: {{ modal_bg_color }} !important;
    }
    {% endif %}
    
    .product-password-modal p {
      font-size: {{ prompt_font_size }}px !important;
    }
  {%- endstyle -%}
  
  <div 
    class="product-password-overlay" 
    data-product-password-id="{{ product.id }}"
    data-product-password-value="{{ access_password }}"
    data-product-password-prompt="{{ access_prompt }}"
  >
    <div class="product-password-modal">
      {%- if show_title -%}
        <h2>{{ 'products.product.password_protected' | t: default: 'Protected Product' }}</h2>
      {%- endif -%}
      
      {%- if access_prompt != blank -%}
        <p>{{ access_prompt }}</p>
      {%- else -%}
        <p>{{ 'products.product.password_prompt' | t: default: 'Please enter the password to access this product.' }}</p>
      {%- endif -%}
      
      <form class="product-password-form">
        <input 
          type="text" 
          class="product-password-input" 
          {% if show_placeholder %}placeholder="{{ 'products.product.password_placeholder' | t: default: 'Enter password' }}"{% endif %}
          autocomplete="off"
          required
        >
        <button type="submit" class="product-password-submit">
          {{ submit_text }}
        </button>
        <div class="product-password-error">
          {{ 'products.product.password_error' | t: default: 'Incorrect password. Please try again.' }}
        </div>
      </form>
    </div>
  </div>
{%- endif -%}
