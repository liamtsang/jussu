{% comment %}
  =================================================================================
  FILE: sections/interactive-dinner-table.liquid
  =================================================================================
{% endcomment %}

<div class="dinner-table-section dinner-table-visibility--{{ section.settings.visibility }}" data-section-id="{{ section.id }}">
  <div class="dinner-table-container">
    <div class="dinner-table">
      {% comment %} Base table background {% endcomment %}
      <div
        class="table-surface"
        {% if section.settings.table_background %}
          style="background-image: url('{{ section.settings.table_background | image_url: width: section.settings.table_width }}');"
        {% endif %}
      ></div>

      {% comment %} Render all product blocks {% endcomment %}
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'product_item' %}
            {% render 'dinner-table-product-item', block: block, section_id: section.id %}
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

<style>
  @media (max-width: 749px) {
    .dinner-table-visibility--desktop_only {
      display: none !important;
    }
  }
  @media (min-width: 750px) {
    .dinner-table-visibility--mobile_only {
      display: none !important;
    }
  }
  .dinner-table-section {
    padding: 0px 0 {{ section.settings.section_padding_bottom }}px;
    background: {{ section.settings.section_background_color }};
  }

  .dinner-table-container {
    margin: 0 auto;
    text-align: center;
    padding: 0 20px;
  }

  .table-title {
    font-size: {{ section.settings.title_font_size }}px;
    color: {{ section.settings.title_color }};
    margin-bottom: 30px;
    font-family: {{ section.settings.title_font.family }}, sans-serif;
    font-weight: {{ section.settings.title_font.weight }};
  }

  .dinner-table {
    position: relative;
    max-height: calc(100vh - 85px - 35px);
    aspect-ratio: {{ section.settings.table_width }} / {{ section.settings.table_height }};
    margin: 0 auto;
    border-radius: {{ section.settings.table_border_radius }}px;
    overflow: hidden;
    /* Calculate scale factor: table height is constrained by viewport, so items should scale relative to table height */
    --table-base-height: {{ section.settings.table_height }};
    --table-max-vh: min(calc(100vh - 85px - 35px), calc((100vw - 40px) * {{ section.settings.table_height }} / {{ section.settings.table_width }}));
  }

  .table-surface {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
  }

  .table-instructions {
    margin-top: 20px;
    font-style: italic;
    color: {{ section.settings.instructions_color }};
    font-size: {{ section.settings.instructions_font_size }}px;
  }
</style>

{% schema %}
{
  "name": "Interactive Dinner Table",
  "settings": [
    {
      "type": "select",
      "id": "visibility",
      "label": "Section Visibility",
      "options": [
        { "value": "always", "label": "Always" },
        { "value": "mobile_only", "label": "Mobile Only" },
        { "value": "desktop_only", "label": "Desktop Only" }
      ],
      "default": "always"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Shop Our Dinner Collection"
    },
    {
      "type": "font_picker",
      "id": "title_font",
      "label": "Title Font",
      "default": "sans-serif"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Title Font Size",
      "min": 20,
      "max": 60,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#333333"
    },
    {
      "type": "image_picker",
      "id": "table_background",
      "label": "Table Background Image",
      "info": "Upload your dinner table background image"
    },
    {
      "type": "range",
      "id": "table_width",
      "label": "Table Width",
      "min": 400,
      "max": 4000,
      "step": 50,
      "default": 1600,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "table_height",
      "label": "Table Height",
      "min": 300,
      "max": 4000,
      "step": 50,
      "default": 1000,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "table_border_radius",
      "label": "Table Corner Radius",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "section_background_color",
      "label": "Section Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Section Padding Top",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Section Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 50,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "show_instructions",
      "label": "Show Instructions",
      "default": true
    },
    {
      "type": "textarea",
      "id": "instructions_text",
      "label": "Instructions Text",
      "default": "Hover over items to see them highlighted, click to shop!"
    },
    {
      "type": "color",
      "id": "instructions_color",
      "label": "Instructions Color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "instructions_font_size",
      "label": "Instructions Font Size",
      "min": 12,
      "max": 24,
      "step": 1,
      "default": 16,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "product_item",
      "name": "Product Item",
      "settings": [
        {
          "type": "url",
          "id": "product",
          "label": "Select Product"
        },
        {
          "type": "image_picker",
          "id": "normal_image",
          "label": "Normal State Image",
          "info": "Image shown by default (outline/subtle version)"
        },
        {
          "type": "image_picker",
          "id": "hover_image",
          "label": "Hover State Image",
          "info": "Image shown on hover (full/highlighted version)"
        },
        {
          "type": "range",
          "id": "position_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "default": 50,
          "unit": "%",
          "info": "Horizontal position from left edge"
        },
        {
          "type": "range",
          "id": "position_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "default": 50,
          "unit": "%",
          "info": "Vertical position from top edge"
        },
        {
          "type": "range",
          "id": "item_width",
          "label": "Item Width",
          "min": 30,
          "max": 1000,
          "step": 10,
          "default": 80,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "item_height",
          "label": "Item Height",
          "min": 30,
          "max": 1000,
          "step": 10,
          "default": 80,
          "unit": "px"
        },
        {
          "type": "select",
          "id": "click_action",
          "label": "Click Action",
          "options": [
            {
              "value": "product_page",
              "label": "Go to Product Page"
            },
            {
              "value": "add_to_cart",
              "label": "Add to Cart"
            },
            {
              "value": "quick_view",
              "label": "Quick View Modal"
            }
          ],
          "default": "product_page"
        },
        {
          "type": "checkbox",
          "id": "show_product_title",
          "label": "Show Product Title on Hover",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_price",
          "label": "Show Price on Hover",
          "default": true
        },
        {
          "type": "range",
          "id": "hover_scale",
          "label": "Hover Scale Effect",
          "min": 100,
          "max": 150,
          "step": 5,
          "default": 110,
          "unit": "%"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Interactive Dinner Table",
      "blocks": [
        {
          "type": "product_item"
        },
        {
          "type": "product_item"
        },
        {
          "type": "product_item"
        }
      ]
    }
  ]
}
{% endschema %}
